-# encoding: utf-8
!!! 5
%html
  %head
    %meta{charset: "utf-8"}
    %title 1C Integration Error Report
    %style{type: "text/css"}
      :css
        body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          line-height: 1.6;
          color: #333;
          max-width: 800px;
          margin: 0 auto;
          padding: 20px;
          background-color: #f5f5f5;
        }
        .container {
          background-color: white;
          border-radius: 8px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          padding: 30px;
        }
        .header {
          background: linear-gradient(135deg, #dc3545, #c82333);
          color: white;
          padding: 20px;
          border-radius: 6px 6px 0 0;
          margin: -30px -30px 20px -30px;
        }
        .header h1 {
          margin: 0;
          font-size: 24px;
          text-align: center;
        }
        .alert {
          background-color: #f8d7da;
          border: 1px solid #f5c6cb;
          border-radius: 4px;
          padding: 15px;
          margin: 15px 0;
        }
        .info-section {
          margin: 20px 0;
          padding: 15px;
          background-color: #f8f9fa;
          border-left: 4px solid #dc3545;
          border-radius: 0 4px 4px 0;
        }
        .info-section h3 {
          margin-top: 0;
          color: #dc3545;
        }
        .log-section {
          background-color: #f1f3f4;
          border: 1px solid #dadce0;
          border-radius: 4px;
          padding: 15px;
          margin: 15px 0;
          font-family: 'Courier New', monospace;
          white-space: pre-wrap;
          font-size: 12px;
          max-height: 400px;
          overflow-y: auto;
        }
        .metadata {
          font-size: 12px;
          color: #666;
          border-top: 1px solid #eee;
          margin-top: 30px;
          padding-top: 15px;
        }
        .critical {
          background-color: #721c24;
          color: white;
          padding: 10px;
          border-radius: 4px;
          text-align: center;
          font-weight: bold;
          margin: 20px 0;
        }
        .action-required {
          background-color: #856404;
          color: white;
          padding: 15px;
          border-radius: 4px;
          margin: 20px 0;
        }
        .stats {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 15px;
          margin: 15px 0;
        }
        .stat-item {
          background-color: #f8f9fa;
          padding: 10px;
          border-radius: 4px;
          text-align: center;
        }
        .stat-value {
          font-size: 18px;
          font-weight: bold;
          color: #dc3545;
        }
  %body
    .container
      .header
        %h1 üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê 1C –ò–ù–¢–ï–ì–†–ê–¶–ò–ò
        
      .critical
        ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ï –í–ú–ï–®–ê–¢–ï–õ–¨–°–¢–í–û –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê
        
      .info-section
        %h3 üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø—Ä–æ—Å–µ
        %p
          %strong ID –∑–∞–ø—Ä–æ—Å–∞:
          = request_id
        %p
          %strong –í—Ä–µ–º—è –æ—à–∏–±–∫–∏:
          = timestamp
        %p
          %strong –°–µ—Ä–≤–µ—Ä:
          = server_info[:host]
        %p
          %strong –û–∫—Ä—É–∂–µ–Ω–∏–µ:
          = server_info[:environment].upcase
          
      .info-section
        %h3 ‚ùå –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏
        %p
          %strong –¢–∏–ø –æ—à–∏–±–∫–∏:
          = error_details[:type]
        %p
          %strong –°–æ–æ–±—â–µ–Ω–∏–µ:
          = error_details[:message]
        - if error_details[:code]
          %p
            %strong –ö–æ–¥ –æ—à–∏–±–∫–∏:
            = error_details[:code]
        - if error_details[:backtrace]
          %p
            %strong –°—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤:
          .log-section
            = error_details[:backtrace]
            
      .info-section
        %h3 üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
        .stats
          - if error_details[:duration]
            .stat-item
              .stat-value= error_details[:duration]
              %div –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫)
          - if error_details[:processed_items]
            .stat-item
              .stat-value= error_details[:processed_items]
              %div –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
          - if error_details[:failed_items]
            .stat-item
              .stat-value= error_details[:failed_items]
              %div –û—à–∏–±–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏
          - if error_details[:http_requests]
            .stat-item
              .stat-value= error_details[:http_requests]
              %div HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
              
      - if log_excerpt && !log_excerpt.empty?
        .info-section
          %h3 üìÑ –í—ã–¥–µ—Ä–∂–∫–∞ –∏–∑ –ª–æ–≥–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å—Ç—Ä–æ–∫)
          .log-section
            = log_excerpt
            
      .action-required
        %h3 üîß –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
        %ul
          %li –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ 1C: https://server-1c.rdp.rozarioflowers.ru
          %li –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: #{PADRINO_ROOT}/log/1c_notify_update.log
          %li –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ Redis
          %li –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–ª—É–∂–±—ã
          %li –£–≤–µ–¥–æ–º–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ
          
      .alert
        %strong ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:
        –ü—Ä–æ—Ü–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å 1C –±—ã–ª –ø—Ä–µ—Ä–≤–∞–Ω. –î–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏.
        –ö–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ü–µ–Ω—ã –∏ –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–æ–≤.
        
      .metadata
        %p
          %strong –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
          RozarioFlowers 1C Integration Monitor
        %p
          %strong –í–µ—Ä—Å–∏—è Ruby:
          = server_info[:ruby_version]
        %p
          %strong –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–∞:
          = Time.now.strftime('%d.%m.%Y %H:%M:%S %Z')
        %p
          %em –≠—Ç–æ—Ç –æ—Ç—á—ë—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ù–µ –æ—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ —ç—Ç–æ –ø–∏—Å—å–º–æ.
