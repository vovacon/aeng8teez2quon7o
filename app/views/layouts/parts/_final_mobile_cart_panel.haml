-# encoding: utf-8
-# –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –º–æ–±–∏–ª—å–Ω–æ–π –ø–∞–Ω–µ–ª–∏ –∫–æ—Ä–∑–∏–Ω—ã (JavaScript-based –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)

.mobile-cart-panel#mobile-cart-panel{style: "display: none;"}
  .mobile-cart-panel__content
    .mobile-cart-panel__items-count
      %span.mobile-cart-panel__count-badge#cart-count-badge 0
    
    %a.mobile-cart-panel__cart-button{ href: "/cart" }
      –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É
    
    .mobile-cart-panel__total-price
      %span.mobile-cart-panel__price#cart-total-price 0 ‚ÇΩ

-# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –±–ª–æ–∫ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±–ª–∞—Å—Ç–∏ –ø–æ–¥ –ø–∞–Ω–µ–ª—å—é –Ω–∞ iPhone
.mobile-cart-panel-filler#cart-panel-filler

:css
  .mobile-cart-panel {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 76px;
    background-color: #fff;
    border-top: 1px solid #ddd;
    box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
    z-index: 9999;
    display: none; /* –°–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
    align-items: center;
    padding: 0 16px;
    /* –î–ª—è iPhone - –∑–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Å–Ω–∏–∑—É */
    padding-bottom: env(safe-area-inset-bottom, 0);
    min-height: calc(76px + env(safe-area-inset-bottom, 0));
  }
  
  /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–ª–æ–∫-–∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å –¥–ª—è iPhone - –∑–∞–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –ø–æ–¥ –ø–∞–Ω–µ–ª—å—é */
  .mobile-cart-panel-filler {
    position: fixed;
    bottom: calc(-1 * env(safe-area-inset-bottom, 0) - 50px); /* –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –ø–æ–¥ –ø–∞–Ω–µ–ª—å—é */
    left: 0;
    right: 0;
    height: calc(50px + env(safe-area-inset-bottom, 0)); /* –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã—Å–æ–∫–∏–π */
    background-color: #fff;
    z-index: 9998; /* –ù–∏–∂–µ –ø–∞–Ω–µ–ª–∏ */
    display: none; /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç */
  }

  .mobile-cart-panel__content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    max-width: 100%;
  }

  .mobile-cart-panel__items-count {
    display: flex;
    align-items: center;
    margin-right: 12px;
  }

  .mobile-cart-panel__count-badge {
    background-color: #ff4757;
    color: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    font-size: 13px;
    font-weight: bold;
    line-height: 25px;
    text-align: center;
    display: block;
    box-sizing: border-box;
  }

  .mobile-cart-panel__cart-button {
    flex: 1;
    text-align: center;
    background-color: #ef845b;
    color: white;
    height: 40px;
    line-height: 40px;
    border-radius: 4px;
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    margin: 0 12px;
    transition: background-color 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .mobile-cart-panel__cart-button:hover {
    background-color: #e6744a;
    color: white;
    text-decoration: none;
  }

  .mobile-cart-panel__total-price {
    font-size: 14px;
    font-weight: bold;
    color: #333;
    white-space: nowrap;
  }

  .mobile-cart-panel__price {
    color: #e74c3c;
    font-size: 16px;
  }

  /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤ (JavaScript —É–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º) */
  @media (max-width: 1023px) {
    .mobile-cart-panel {
      /* –£–¥–∞–ª—è–µ–º !important - –ø–æ–∑–≤–æ–ª—è–µ–º JavaScript —É–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º */
    }
    
    /* –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –∫–æ—Ä–∑–∏–Ω—ã */
    body[data-page-cart] .mobile-cart-panel {
      display: none !important;
    }
    
    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü –∫–æ—Ä–∑–∏–Ω—ã */
    .mobile-cart-panel[data-cart-page="true"] {
      display: none !important;
    }
    
    /* –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è body —Å —É—á–µ—Ç–æ–º safe area */
    body:not([data-page-cart]) {
      padding-bottom: calc(76px + env(safe-area-inset-bottom, 0));
    }
    
    /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
    .mobile-cart-panel-filler {
      display: none;
    }
  }

  @media (min-width: 1024px) {
    .mobile-cart-panel {
      display: none !important;
    }
  }
  
  /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è */
  .cart-panel-hidden {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    transform: translateY(100%) !important;
    pointer-events: none !important;
  }

:javascript
  // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–µ–π —á–∞—Ç–∞ TalkMe
  window.updateChatPosition = function(showPanel) {
    // –ù–∞–π–¥—ë–º —Å—Ç–∏–ª—å TalkMe –∏–ª–∏ —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π
    let chatStyle = document.getElementById('TalkMe_online-chat-trigger');
    if (!chatStyle) {
      chatStyle = document.createElement('style');
      chatStyle.id = 'TalkMe_online-chat-trigger';
      document.head.appendChild(chatStyle);
    }
    
    const bottomValue = showPanel ? '116px' : '40px'; // 76px –ø–∞–Ω–µ–ª—å + 40px –æ—Ç—Å—Ç—É–ø = 116px
    chatStyle.textContent = `.online-chat-root-TalkMe #supportTrigger, #supportTrigger {
      bottom: ${bottomValue} !important; 
      right: 24px !important;
      z-index: 10001 !important;
      position: fixed !important;
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
    }
    .online-chat-root-TalkMe #supportTrigger.hidden, #supportTrigger.hidden {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
    }`;
    
    // console.log('Chat position updated:', bottomValue);
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–∞–º —ç–ª–µ–º–µ–Ω—Ç
    const supportTrigger = document.getElementById('supportTrigger');
    if (supportTrigger) {
      supportTrigger.style.bottom = bottomValue + ' !important';
      supportTrigger.style.zIndex = '10001';
      supportTrigger.style.position = 'fixed';
      
      // –ë–æ—Ä—å–±–∞ —Å –≤–µ–Ω–¥–æ—Ä–Ω—ã–º –∫–ª–∞—Å—Å–æ–º hidden
      if (supportTrigger.classList.contains('hidden')) {
        supportTrigger.classList.remove('hidden');
        // console.log('Removed vendor hidden class from chat');
      }
      
      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      supportTrigger.style.display = 'block';
      supportTrigger.style.visibility = 'visible';
      supportTrigger.style.opacity = '1';
      
      // console.log('Chat trigger element directly updated:', bottomValue, 'with z-index: 10001');
    }
  };
  
  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —á–∞—Ç–∞
  window.findAndPositionChat = function() {
    const cartPanel = document.getElementById('mobile-cart-panel');
    const supportTrigger = document.getElementById('supportTrigger');
    
    if (supportTrigger && cartPanel) {
      const panelVisible = window.getComputedStyle(cartPanel).display === 'flex';
      const isMobile = window.innerWidth < 1024;
      const shouldPositionChat = panelVisible && isMobile;
      
      window.updateChatPosition(shouldPositionChat);
      
      // –û—Ç–º–µ—á–∞–µ–º, —á—Ç–æ —á–∞—Ç —É–∂–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω
      if (!supportTrigger.hasAttribute('data-cart-positioned')) {
        supportTrigger.setAttribute('data-cart-positioned', 'true');
      }
      
      // console.log('Chat found and positioned:', shouldPositionChat ? '116px' : '40px', 'Mobile:', isMobile, 'Panel visible:', panelVisible);
      return true;
    }
    
    return false;
  };

  document.addEventListener('DOMContentLoaded', function() {
    const cartPanel = document.getElementById('mobile-cart-panel');
    const cartFiller = document.getElementById('cart-panel-filler');
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞–Ω–µ–ª–∏ —á–µ—Ä–µ–∑ AJAX
    function updateCartPanel() {
      console.log('[CART PANEL DEBUG] === Starting updateCartPanel ===', new Date().toLocaleTimeString());
      fetch('/cart/stat?_=' + Date.now(), {
        method: 'GET',
        headers: {
          'X-Requested-With': 'XMLHttpRequest',
          'Cache-Control': 'no-cache, no-store, must-revalidate',
          'Pragma': 'no-cache',
          'Expires': '0'
        }
      })
      .then(response => {
        console.log('[CART PANEL DEBUG] Response status:', response.status);
        return response.json();
      })
      .then(data => {
        console.log('[CART PANEL DEBUG] Received data:', data);
        const countBadge = document.getElementById('cart-count-badge');
        const totalPrice = document.getElementById('cart-total-price');
        
        if (countBadge && data.total_q !== undefined) {
          countBadge.textContent = data.total_q;
          console.log('[CART PANEL DEBUG] Updated count badge:', data.total_q);
        }
        if (totalPrice && data.total_s !== undefined) {
          totalPrice.textContent = Math.round(data.total_s) + ' ‚ÇΩ';
          console.log('[CART PANEL DEBUG] Updated total price:', Math.round(data.total_s));
        }
        
        // –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞: –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å
        const hasItems = (data.total_q || 0) > 0;
        const currentPath = window.location.pathname;
        const currentUrl = window.location.href;
        const isCartPage = currentPath.startsWith('/cart') || currentUrl.includes('/cart');
        
        // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞: —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
        const shouldShowPanel = hasItems;
        
        // –ü–æ–ª–Ω–æ–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        console.log('[CART PANEL DEBUG] Analysis:', {
          'Total items (total_q)': data.total_q,
          'Total sum (total_s)': data.total_s,
          'hasItems': hasItems,
          'shouldShowPanel': shouldShowPanel,
          'currentPath': currentPath,
          'currentUrl': currentUrl,
          'isCartPage': isCartPage,
          'screenWidth': window.innerWidth,
          'isMobile': window.innerWidth < 1024,
          'finalDecision': shouldShowPanel && !isCartPage && window.innerWidth < 1024,
          'panelElement': !!cartPanel,
          'panelCurrentDisplay': cartPanel ? cartPanel.style.display : 'no element',
          'timestamp': new Date().toLocaleTimeString()
        });
        


        if (cartPanel) {
          if (shouldShowPanel && !isCartPage && window.innerWidth < 1024) {
            console.log('[CART PANEL DEBUG] ‚úÖ SHOWING PANEL - Items:', data.total_q, 'Sum:', data.total_s);
            console.log('[CART PANEL DEBUG] Panel display before show:', cartPanel.style.display);
            
            // –û—á–∏—â–∞–µ–º –≤—Å–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä—ã—Ç–∏—è
            cartPanel.style.display = 'flex';
            cartPanel.style.visibility = 'visible';
            cartPanel.style.opacity = '1';
            cartPanel.style.transform = 'translateY(0)';
            cartPanel.classList.remove('cart-panel-hidden');
            cartPanel.removeAttribute('data-cart-page');
            document.body.style.paddingBottom = 'calc(76px + env(safe-area-inset-bottom, 0))';
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ –Ω–∞ iOS —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
            if (cartFiller && /iPad|iPhone|iPod/.test(navigator.userAgent)) {
              cartFiller.style.display = 'block';
            }
            // –ü–æ–¥–Ω–∏–º–∞–µ–º —á–∞—Ç –Ω–∞–¥ –ø–∞–Ω–µ–ª—å—é
            window.updateChatPosition(true);
          } else {
            let reason = 'unknown';
            if (!shouldShowPanel) {
              reason = 'no items in cart';
            } else if (isCartPage) {
              reason = 'on cart page';
            } else if (window.innerWidth >= 1024) {
              reason = 'desktop screen';
            }
            console.log('[CART PANEL DEBUG] ‚ùå HIDING PANEL - Reason:', reason);
            console.log('[CART PANEL DEBUG] Panel display before hide:', cartPanel.style.display);
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏
            cartPanel.style.display = 'none';
            cartPanel.style.visibility = 'hidden';
            cartPanel.classList.add('cart-panel-hidden');
            
            // –ü—Ä–æ—Å—Ç–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
            
            if (isCartPage) cartPanel.setAttribute('data-cart-page', 'true');
            document.body.style.paddingBottom = '0';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å
            if (cartFiller) {
              cartFiller.style.display = 'none';
            }
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —á–∞—Ç –≤ –æ–±—ã—á–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ
            window.updateChatPosition(false);
          }
        } else {
          console.log('[CART PANEL DEBUG] ‚ö†Ô∏è Cart panel element not found! #mobile-cart-panel');
        }
      })
      .catch(error => {
        console.error('[CART PANEL DEBUG] üö® Update failed:', error);
      });
    }
    
    if (cartPanel) {
      console.log('[CART PANEL DEBUG] üöÄ Cart panel element found, starting initialization...');
      
      // –ù–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
      updateCartPanel();
      
      // –£–±—Ä–∞–Ω –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
      
      // –ü—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥—ë–∂–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–∏ —á–∞—Ç–∞
      // –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —á–∞—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
      setTimeout(() => window.findAndPositionChat(), 100);
      
      // –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
      setTimeout(() => window.findAndPositionChat(), 500);
      setTimeout(() => window.findAndPositionChat(), 1000);
      setTimeout(() => window.findAndPositionChat(), 2000);
      setTimeout(() => window.findAndPositionChat(), 3000);
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞ - —Å –¥–µ–±–∞—É–Ω—Å–æ–º
      let resizeTimeout;
      window.addEventListener('resize', function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          console.log('[CART PANEL DEBUG] üìè Window resized, updating panel. New width:', window.innerWidth);
          updateCartPanel();
          window.findAndPositionChat();
        }, 300); // –î–µ–±–∞—É–Ω—Å
      });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∫–ª–∏–∫–∞—Ö –ø–æ —Å—Å—ã–ª–∫–∞–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É
      document.addEventListener('click', function(e) {
        const target = e.target.closest('a[href*="/cart/add/"], a[href*="/add-to-cart/"]');
        if (target) {
          console.log('[CART PANEL DEBUG] üí∞ Cart add clicked, will update in 1.5s:', target.href);
          setTimeout(() => {
            console.log('[CART PANEL DEBUG] üîÑ Executing delayed update after cart add');
            updateCartPanel();
          }, 1500);
        }
      });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É
      document.addEventListener('submit', function(e) {
        const form = e.target;
        if (form.action && (form.action.includes('/cart/add/') || form.action.includes('/add-to-cart/'))) {
          console.log('[CART PANEL DEBUG] üìù Cart form submitted:', form.action);
          setTimeout(() => {
            console.log('[CART PANEL DEBUG] üîÑ Executing delayed update after form submit');
            updateCartPanel();
          }, 1500);
        }
      });
      
      // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã)
      setInterval(() => {
        console.log('[CART PANEL DEBUG] ‚è∞ Periodic update triggered');
        updateCartPanel();
      }, 120000);
      
      // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –±–æ—Ä—å–±–∞ —Å –≤–µ–Ω–¥–æ—Ä–Ω—ã–º –∫–ª–∞—Å—Å–æ–º hidden (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥)
      setInterval(function() {
        const supportTrigger = document.getElementById('supportTrigger');
        if (supportTrigger && supportTrigger.classList.contains('hidden')) {
          supportTrigger.classList.remove('hidden');
          // console.log('Removed vendor hidden class from chat (periodic check)');
          
          // –ü–µ—Ä–µ–ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º —á–∞—Ç
          window.findAndPositionChat();
        }
      }, 5000);
      
      // –ü—Ä–æ—Å—Ç–∞—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–∞—Ç–∞ (–ø–µ—Ä–≤—ã–µ 5 —Å–µ–∫—É–Ω–¥)
      let chatFoundCount = 0;
      const chatCheckInterval = setInterval(() => {
        if (window.findAndPositionChat()) {
          chatFoundCount++;
          // –ü—Ä–µ–∫—Ä–∞—â–∞–µ–º –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ 2 —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
          if (chatFoundCount >= 2) {
            clearInterval(chatCheckInterval);
            // console.log('Chat positioning checks completed successfully');
          }
        }
      }, 1000); // –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
      
      // –°—Ç–æ–ø –ø—Ä–æ–≤–µ—Ä–æ–∫ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
      setTimeout(() => {
        clearInterval(chatCheckInterval);
        // console.log('Chat positioning checks timeout - stopped');
      }, 5000);
    }
    
    // –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å –∑–∞ –ø–æ—è–≤–ª–µ–Ω–∏–µ–º —á–∞—Ç–∞ TalkMe
    const chatObserver = new MutationObserver(function(mutations) {
      if (window.findAndPositionChat()) {
        // console.log('TalkMe chat detected via MutationObserver');
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è –Ω–æ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —á–∞—Ç–∞
        const supportTrigger = document.getElementById('supportTrigger');
        if (supportTrigger && !supportTrigger.hasAttribute('data-class-observer-set')) {
          supportTrigger.setAttribute('data-class-observer-set', 'true');
          chatClassObserver.observe(supportTrigger, { attributes: true, attributeFilter: ['class'] });
          // console.log('Class observer set for new chat element');
        }
      }
    });
    
    // –û—Ç–¥–µ–ª—å–Ω—ã–π –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–ª–∞—Å—Å–æ–≤ —á–∞—Ç–∞
    const chatClassObserver = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
          const supportTrigger = mutation.target;
          if (supportTrigger.id === 'supportTrigger' && supportTrigger.classList.contains('hidden')) {
            supportTrigger.classList.remove('hidden');
            // console.log('Vendor added hidden class - removed immediately');
            window.findAndPositionChat();
          }
        }
      });
    });
    
    // –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–ª–∞—Å—Å–æ–≤ —É —á–∞—Ç–∞ (–µ—Å–ª–∏ –æ–Ω —É–∂–µ –µ—Å—Ç—å)
    const supportTrigger = document.getElementById('supportTrigger');
    if (supportTrigger) {
      chatClassObserver.observe(supportTrigger, { attributes: true, attributeFilter: ['class'] });
    }
    
    // –ù–∞—á–∏–Ω–∞–µ–º –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ DOM
    chatObserver.observe(document.body, { childList: true, subtree: true });
    
    // –§–∏–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('load', function() {
      setTimeout(() => {
        window.findAndPositionChat();
        // console.log('Final chat positioning attempt on window load');
      }, 1000);
      
      // –ï—â—ë –æ–¥–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(() => {
        window.findAndPositionChat();
        // console.log('Last resort chat positioning attempt');
      }, 3000);
    });
    
    console.log('[CART PANEL DEBUG] üìé Mobile cart panel loaded and initialized', {
      'Panel element exists': !!cartPanel,
      'Screen width': window.innerWidth,
      'Current path': window.location.pathname,
      'Timestamp': new Date().toLocaleTimeString()
    });
  });
